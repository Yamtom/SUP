# SUP

## 1.3. Цілі та Завдання

- **Централізація даних:** створення єдиного джерела даних для всього персоналу, графіків, відпусток та обладнання.
- **Автоматизація планування:** спрощення процесу створення місячних графіків чергувань.
- **Оперативне управління:** надання інструменту для щоденного планування ("План на сьогодні").
- **Аналітика та звітність:** автоматичний розрахунок навантаженості, підрахунок типів чергувань, відстеження відпусток.
- **Інтеграція:** синхронізація розкладів з Google Calendar для зручного доступу персоналу.

## 2. Аналіз Існуючої Системи

Поточна система реалізована на базі Google Sheets і складається з декількох взаємопов'язаних аркушів.

### 2.1. Аркуші Місячних Графіків (наприклад, 12.24, 01.25 … 11.25)

- **Сутність:** ядро системи — матриця «Персонал» × «Дні місяця».
- **Дані:** містить коди чергувань (зп, рс, рх, вп, р4, р11 тощо) для кожного співробітника на кожен день.
- **Аналітика:** розраховує сумарні показники по кожному типу чергування (р, зп, ВСЬОГО) та визначає «Найбільш навантаженого пілота/штурмана».

### 2.2. Аркуш «План» (План.csv)

- **Сутність:** оперативний план на поточний день («Застосування на сьогодні»).
- **Дані:** прив'язка підрозділів (11 ПрикЗ, БПАК 1), персоналу (пілот, штурман), обладнання (БПЛА, ТЗ, АКБ) та часу.

### 2.3. Аркуш «Бібліотека» (Бібліотека.csv)

- **Сутність:** довідник або майстер-дані.
- **Дані:** містить список персоналу, позивних, прив'язку до підрозділів та обладнання.

### 2.4. Аркуш «Відпустки» (Відпустки.csv)

- **Сутність:** річний графік відпусток.
- **Дані:** матриця «Персонал» × «Місяці» з датами запланованих відпусток.

### 2.5. Аркуш Конфігурації (GCAL_CONFIG.csv)

- **Сутність:** технічний аркуш для налаштування інтеграції.
- **Дані:** містить `calendarId`, `sheetsWhitelist` (список аркушів для синхронізації), `dateColumns` (діапазон дат).

## 3. Модулі Системи

### 3.1. Модуль «Адміністрування та Довідники»

- Управління персоналом (заміна Бібліотека.csv): додавання/редагування пілотів, штурманів, їх ролей, позивних.
- Управління «Типами Чергувань»: визначення кодів (зп, рс, рх), їх кольорів для календаря, описів.
- Управління довідниками обладнання (БПЛА, ТЗ, АКБ).
- Управління користувачами та правами доступу (адміністратор, планувальник, глядач).

### 3.2. Модуль «Планувальник Графіків» (заміна місячних аркушів)

- **UI:** інтерактивний календар (вигляд на місяць/тиждень).
- **Функціонал:**
  - відображення сітки «Персонал» × «Дні»;
  - призначення чергувань шляхом вибору зі списку або drag-and-drop для кожної комірки;
  - автоматичне кольорове кодування комірок відповідно до типу чергування;
  - відображення конфліктів (наприклад, чергування під час відпустки);
  - миттєвий підрахунок загальної кількості чергувань та навантаженості за місяць.

### 3.3. Модуль «Оперативний План» (заміна План.csv)

- **UI:** форма для створення/редагування плану на конкретну дату («План на сьогодні»).
- **Функціонал:**
  - додавання записів (місій/завдань);
  - вибір пілота/штурмана з довідника персоналу;
  - вибір обладнання з довідників;
  - вказання часу та приміток;
  - відображення персоналу, який доступний згідно з місячним графіком.

### 3.4. Модуль «Графік Відпусток» (заміна Відпустки.csv)

- **UI:** річний календар (вигляд, подібний до Gantt).
- **Функціонал:** планування та затвердження відпусток; автоматична інтеграція з «Планувальником Графіків» (блокування дат для чергувань).

### 3.5. Модуль «Аналітика та Звіти»

- **UI:** дашборд.
- **Функціонал:** динамічний звіт «Найбільш навантажений персонал» за обраний період; загальна кількість чергувань (за типом) по всьому персоналу; звіт по використаних відпустках; експорт звітів у CSV/PDF.

## 4. Загальні Вимоги

- Система має бути веб-додатком, доступним через сучасні браузери (Chrome, Firefox, Safari).
- Дизайн має бути адаптивним (responsive) для коректного відображення на ПК, планшетах та мобільних пристроях.
- Обов'язкова наявність автентифікації та авторизації користувачів.

## 4.1. Функціональні Вимоги

### Головна Сторінка (Дашборд)

- Відображає «Оперативний План» на сьогодні.
- Показує, хто з персоналу на чергуванні, відпочинку або у відпустці.
- Містить швидкі посилання на ключові модулі.

### Модуль «Планувальник Графіків»

- Вибір місяця та року для відображення/редагування.
- Можливість копіювання графіку (або частини) з попереднього періоду.
- Автозбереження змін.
- Підсвічування вихідних та святкових днів.
- Відображення сумарної статистики по кожному співробітнику в реальному часі (кількість зп, рс тощо).

### Модуль «Оперативний План»

- При виборі дати форма показує список персоналу, вільного для завдань (не у відпустці, не «зп» тощо).
- Можливість друку «Плану на сьогодні».

### Інтеграція з Google Calendar

- Автоматична (за розкладом, наприклад раз на годину) публікація персоналізованих графіків чергувань у Google Календарі співробітників (використовуючи `calendarId` з налаштувань).
- Одностороння синхронізація (із системи в GCal) для уникнення конфліктів.

## 4.2. Нефункціональні Вимоги

- **Надійність:** система має бути доступна 99.9% часу.
- **Безпека:** усі дані передаються по HTTPS, паролі зберігаються у хешованому вигляді.
- **Продуктивність:** завантаження сторінок та календарів не повинно перевищувати 3 секунд.

## 5. Мінімальна Реалізація SUP

Поточний репозиторій містить робочу референсну реалізацію веб-застосунку, що відповідає зазначеним вимогам. Рішення побудовано як легковаговий Python-сервер на базі стандартної бібліотеки (`http.server`) та клієнтського застосунку на чистому JavaScript.

Основні можливості:

- **Автентифікація та авторизація** з поділом ролей (admin, planner, viewer) та простими сесіями на токенах.
- **Дашборд** з оперативним планом і статусами персоналу на поточний день.
- **Довідники** персоналу, типів чергувань, обладнання — використовуються для підбору екіпажів та ресурсів.
- **Планувальник графіків** з унесенням призначень за датами та обраним персоналом/типом чергування.
- **Оперативний план** на конкретний день з вибором екіпажів та техніки.
- **Графік відпусток** для блокування доступності персоналу.
- **Аналітика** за обраний період: підсумок за типами чергувань і завантаженістю персоналу.

Дані зберігаються в локальній базі SQLite (`app/app.db`), яка ініціалізується та наповнюється демонстраційними записами при першому запуску.

### 5.1. Запуск у режимі розробки

> **Вимога:** Python 3.11+ (жодних сторонніх залежностей встановлювати не потрібно).

```bash
python -m app.server
```

Після запуску застосунок доступний за адресою [http://localhost:8000](http://localhost:8000). Для вхідних тестових облікових записів використайте:

- `admin` / `admin123`
- `planner` / `plan123`
- `viewer` / `view123`

### 5.2. Структура Каталогів

- `app/server.py` — HTTP-сервер, REST API та маршрути статичних файлів.
- `app/db.py` — ініціалізація та наповнення бази даних.
- `app/security.py`, `app/auth.py` — механізми хешування паролів і токени сесій.
- `app/static/` — клієнтський застосунок (HTML, CSS, JS).

### 5.3. Подальший Розвиток

Реалізацію можна розширити додаванням повноцінного календарного UI, інтеграцією з Google Calendar, експортуванням у PDF/CSV, а також розмежуванням доступу на рівні API за допомогою JWT чи OAuth 2.0.
